name: Cache Warmup

on:
  schedule:
    # Executa todos os dias às 6h (horário de Brasília = UTC-3)
    - cron: '0 9 * * *'  # 9h UTC = 6h BRT
  workflow_dispatch:  # Permite execução manual via GitHub UI

jobs:
  warmup-all-backends:
    name: Warmup Cache - All Backends
    runs-on: ubuntu-latest
    timeout-minutes: 15
    steps:
      - name: Warmup Lush Ipiranga
        run: |
          curl -X POST "${{ secrets.LUSH_IPIRANGA_URL }}/cache/warmup" \
            -H "Content-Type: application/json" \
            --max-time 180 \
            --fail

      - name: Warmup Lush Lapa
        run: |
          curl -X POST "${{ secrets.LUSH_LAPA_URL }}/cache/warmup" \
            -H "Content-Type: application/json" \
            --max-time 180 \
            --fail

      - name: Warmup Andar de Cima
        run: |
          curl -X POST "${{ secrets.ANDAR_DE_CIMA_URL }}/cache/warmup" \
            -H "Content-Type: application/json" \
            --max-time 180 \
            --fail

      - name: Warmup Tout
        run: |
          curl -X POST "${{ secrets.TOUT_URL }}/cache/warmup" \
            -H "Content-Type: application/json" \
            --max-time 180 \
            --fail

      - name: Warmup Authentication
        run: |
          curl -X POST "${{ secrets.AUTHENTICATION_URL }}/cache/warmup" \
            -H "Content-Type: application/json" \
            --max-time 180 \
            --fail
