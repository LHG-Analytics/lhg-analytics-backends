name: Cache Warmup

on:
  schedule:
    # Executa a cada 6 horas (horário de Brasília = UTC-3)
    # 0h, 6h, 12h, 18h BRT = 3h, 9h, 15h, 21h UTC
    - cron: '0 3,9,15,21 * * *'
  workflow_dispatch:  # Permite execução manual via GitHub UI

jobs:
  warmup-all-backends:
    name: Warmup Cache - All Backends
    runs-on: ubuntu-latest
    timeout-minutes: 15
    steps:
      - name: Warmup Lush Ipiranga
        run: |
          curl -X POST "${{ secrets.LUSH_IPIRANGA_URL }}/cache/warmup" \
            -H "Content-Type: application/json" \
            --max-time 180 \
            --fail

      - name: Warmup Lush Lapa
        run: |
          curl -X POST "${{ secrets.LUSH_LAPA_URL }}/cache/warmup" \
            -H "Content-Type: application/json" \
            --max-time 180 \
            --fail

      - name: Warmup Andar de Cima
        run: |
          curl -X POST "${{ secrets.ANDAR_DE_CIMA_URL }}/cache/warmup" \
            -H "Content-Type: application/json" \
            --max-time 180 \
            --fail

      - name: Warmup Tout
        run: |
          curl -X POST "${{ secrets.TOUT_URL }}/cache/warmup" \
            -H "Content-Type: application/json" \
            --max-time 180 \
            --fail

      - name: Warmup Authentication
        run: |
          curl -X POST "${{ secrets.AUTHENTICATION_URL }}/cache/warmup" \
            -H "Content-Type: application/json" \
            --max-time 180 \
            --fail
